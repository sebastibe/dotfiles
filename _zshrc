# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Path to development folder
export DEV=$HOME/Dev
export DEPLOY_USER="seb"
export DEFAULT_USER="seb"

# Locales
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

# GO
export GOPATH=$DEV/go

# Set the list of directories that Zsh searches for programs.
path=(
    /usr/local/{bin,sbin}
    /usr/local/share/npm/bin
    $GOPATH/bin
    $HOME/.cabal/bin
    /Applications/Postgres.app/Contents/Versions/9.4/{bin,lib}
    /usr/local/heroku/bin
    $HOME/.pyenv/shims
    $path
)

# OSX
alias fixow='/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain user;killall Finder;echo "Open With has been rebuilt, Finder will relaunch"'

# Tmux
alias tma='tmux attach -d -t'
alias tmn='tmux new -s $(basename $(pwd))'
alias tml='tmux list-sessions'

# Emacs
alias em="emacsclient -n"
export EDITOR="emacsclient -n"
export SHELL="/bin/zsh"

# Bower
alias bower='noglob bower'

# Postgres
export PGHOST=/tmp

# Python
export WORKON_HOME=$DEV
export VIRTUALENVWRAPPER_LOG_DIR="logs"
export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'
export PYENV_VIRTUALENVWRAPPER_PREFER_PYVENV='true'
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
pyenv virtualenvwrapper
alias bpython="python -m bpython.cli"
export PIP_VIRTUALENV_BASE=$WORKON_HOME

# Node.js / Io.js
export NVM_DIR=~/.nvm
source $(brew --prefix nvm)/nvm.sh

# Prezto modules
zstyle ':prezto:load' pmodule \
       'environment' \
       'terminal' \
       'editor' \
       'history' \
       'history-substring-search' \
       'directory' \
       'spectrum' \
       'utility' \
       'completion' \
       'homebrew' \
       'osx' \
       'ruby' \
       'rails' \
       'git' \
       'node' \
       'python' \
       'haskell' \
       'syntax-highlighting' \
       'tmux' \
       'utility' \
       'prompt'

# Presto Theme
zstyle ':prezto:module:prompt' theme 'superlinh'

# iTerm2 window/tab color commands
#   Requires iTerm2 >= Build 1.0.0.20110804
#   http://code.google.com/p/iterm2/wiki/ProprietaryEscapeCodes
tab-color() {
    echo -ne "\033]6;1;bg;red;brightness;$1\a"
    echo -ne "\033]6;1;bg;green;brightness;$2\a"
    echo -ne "\033]6;1;bg;blue;brightness;$3\a"
}
tab-reset() {
    echo -ne "\033]6;1;bg;*;default\a"
}

# Change the color of the tab when using SSH
# reset the color after the connection closes
color-ssh() {
    if [[ -n "$ITERM_SESSION_ID" ]]; then
        trap "tab-reset" INT EXIT
        if [[ "$*" =~ "production|ec2-.*compute-1" ]]; then
            tab-color 255 0 0
        else
            tab-color 0 255 0
        fi
    fi
    ssh $*
}
compdef _ssh color-ssh=ssh

alias ssh=color-ssh

_archey() {
    if hash archey 2>/dev/null; then
        archey
    else
        echo -ne "$ brew install archey"
    fi
}

_archey

# Cheat
export CHEATCOLORS=true
